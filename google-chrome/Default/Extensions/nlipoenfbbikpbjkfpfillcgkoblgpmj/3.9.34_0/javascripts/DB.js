function onError(e){console.log("[DB error]: "+e)}window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,"webkitIndexedDB"in window&&(window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange);var DB={db:null,log:function(){var e=Array.prototype.slice.apply(arguments);return e.unshift("[DB]: "),console.log.apply(window,e)},init:function(){return new Promise(function(e,r){var n=indexedDB.open("AwesomeScreenshot",1);n.onupgradeneeded=function(e){console.log("onupgradeneeded",e);var r=e.target.result;e.target.transaction.onerror=onError,r.objectStoreNames.contains("recordings")&&r.deleteObjectStore("recordings"),r.createObjectStore("recordings",{autoIncrement:!0}).createIndex("by_id","id",{unique:!0})},n.onsuccess=function(r){DB.db=r.target.result,e(r.target.result)},n.onerror=function(e){onError(e),r(e)}})},save:function(e){var r=this.db;return new Promise(function(n,o){var t=r.transaction(["recordings"],"readwrite").objectStore("recordings"),i=(new Date).getTime(),s=t.put({id:i,fileUrl:e.fileUrl,detail:{title:e.title,youtubeUrl:"",gDriveUrl:"",size:e.size,duration:e.duration,timeStamp:i,thumbnailUrl:""}});s.onsuccess=function(){n(i)},s.onerror=o})},get:function(e){var r=this.db;return new Promise(function(n,o){var t=r.transaction(["recordings"],"readwrite").objectStore("recordings").index("by_id").get(e);t.onsuccess=function(e){var r=e.target.result;n(r)},t.onerror=o})},getAll:function(){var e=this.db;return new Promise(function(r,n){var o=e.transaction(["recordings"],"readwrite").objectStore("recordings").getAll();o.onsuccess=function(e){var n=e.target.result;r(n)},o.onerror=n})},_getCursor:function(e){var r=this.db;return new Promise(function(n,o){var t=r.transaction(["recordings"],"readwrite").objectStore("recordings"),i=IDBKeyRange.only(e),s=t.index("by_id").openCursor(i);s.onsuccess=function(e){var r=e.target.result;r&&n(r)},s.onerror=o})},updateYoutubeUrl:function(e,r){var n=this;return new Promise(function(o,t){n._getCursor(e).then(function(e){e.value.detail.youtubeUrl=r;var n=e.update(e.value);n.onsuccess=o,n.onerror=t})})},update:function(e,r){var n=this.db;return new Promise(function(o,t){var i=n.transaction(["recordings"],"readwrite").objectStore("recordings"),s=IDBKeyRange.only(e),c=i.index("by_id").openCursor(s);c.onsuccess=function(e){var n=e.target.result;n&&(n.update(r).onsuccess=function(){o()})},c.onerror=t})},deleteAll:function(){var e=this.db;return new Promise(function(r,n){var o=e.transaction(["recordings"],"readwrite").objectStore("recordings").clear();o.onsuccess=function(e){var n=e.target.result;r(n)},o.onerror=n})},delete:function(e){var r=this.db;return new Promise(function(n,o){var t=r.transaction(["recordings"],"readwrite").objectStore("recordings"),i=IDBKeyRange.only(e),s=t.index("by_id").openCursor(i);s.onsuccess=function(e){var r=e.target.result;r&&(r.delete().onsuccess=function(){n()})},s.onerror=o})}};