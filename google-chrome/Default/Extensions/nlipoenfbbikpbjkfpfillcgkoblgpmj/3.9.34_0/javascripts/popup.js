function updateTime(){$("#recording-view").find(".time").text(Bg.recordingTime)}var Bg=chrome.extension.getBackgroundPage(),recordingTimer=null;chrome.cookies.getAll({url:"https://www.awesomescreenshot.com"},function(e){if(e){for(var t=0,o=e.length;t<o;t++)if("screenshot_personal_fullname"===e[t].name)var c=decodeURI(e[t].value);else if("screenshot_personal_type"===e[t].name){console.log(e[t]);var r=e[t].value}c?($(".aws-info").find(".user-name").text(c).attr("title",c),$(".aws-info").show(),$(".aws-login").hide()):($(".aws-info").hide(),$(".aws-login").show()),console.log(r,typeof r),"0"==r?$(".aws-user").removeClass("premium"):void 0===r?($(".aws-premium-icon").hide(),$(".aws-upgrade").hide()):$(".aws-user").addClass("premium")}}),$(document).ready(function(){function e(e){$(".layout-view").hide(),$("#"+e).show()}function t(){$("ul").remove(),$(".aws-account, .sep").hide(),$("#capturing").fadeIn("slow")}function o(e){chrome.extension.sendRequest(e)}chrome.windows.getCurrent(function(e){chrome.tabs.getSelected(e.id,function(t){chrome.browserAction.getBadgeText({tabId:t.id},function(t){"New"==t&&(chrome.browserAction.setBadgeText({text:""}),chrome.tabs.create({url:"https://blog.awesomescreenshot.com/2017/11/29/four-new-annotation-types-as-premium-features/"}),localStorage.newClickVersion="3.9.31",e.close())})})});var c,r=!0;$(".i18n").each(function(){var e=this,t=e.id;$(e).html(chrome.i18n.getMessage(t.replace(/-/,"")))}),$(".title").each(function(){var e=this,t=e.id;$(e).attr({title:chrome.i18n.getMessage(t.replace(/-/,"")+"_title")})}),function(){if(localStorage.msObj){var e=JSON.parse(localStorage.msObj),t=1==e.visible.enable?"Ctrl+Shift+"+e.visible.key:"Not set",o=1==e.selected.enable?"Ctrl+Shift+"+e.selected.key:"Not set",c=1==e.entire.enable?"Ctrl+Shift+"+e.entire.key:"Not set";$("#visible").find(".shortcut").remove().end().append("<span class='shortcut'>"+t+"</span>"),$("#selected").find(".shortcut").remove().end().append("<span class='shortcut'>"+o+"</span>"),$("#entire").find(".shortcut").remove().end().append("<span class='shortcut'>"+c+"</span>")}}(),!localStorage.capture_desktop||localStorage.capture_desktop,chrome.windows.getCurrent(function(e){chrome.tabs.getSelected(e.id,function(e){console.log(new Date),(null==(c=e.url).match(/https?:\/\/*\/*/gi)||c.match(/https:\/\/chrome.google.com\/extensions/i))&&$("#selected, #delay-capture").attr({title:chrome.i18n.getMessage("disableEntireTitle")}).css({color:"#909090"}).unbind("click"),"complete"!=e.status&&($("#selected").attr({title:"Page still loading! Please wait."}).css({color:"#909090"}),r=!1),/http|https|file|ftp/.test(c.slice(0,5))||$("#visible").css({color:"#909090"}).unbind("click")})}),Bg.isRecording&&(e("recording-view"),Bg.isRecordingPaused&&$("#recording-view").find(".recording-action").addClass("paused"),recordingTimer=setInterval(updateTime,100)),chrome.extension.onRequest.addListener(function(e,t,o){switch(e.action){case"enable_selected":if(c.match(/https:\/\/*\/*/gi))return void $("#selected").attr({title:"For security reason, Capture Selected Area doesn't work in https pages!"});r=!0,$("#selected").attr({title:""}).css({color:"#000"});break;case"shownew":case"closeWin":window.close()}}),$("a").click(function(){var c=this.id;if("visible"==c&&(-1!=navigator.appVersion.indexOf("Chrome/11")&&/^file:\/\/*/.test(n)?alert("You can't capture local page's in Chrome beta!"):o({action:c}),window.close()),"delay-capture"==c&&(-1!=navigator.appVersion.indexOf("Chrome/11")&&/^file:\/\/*/.test(n)?alert("You can't capture local page's in Chrome beta!"):chrome.tabs.getSelected(null,function(e){chrome.tabs.sendRequest(e.id,{action:c,sec:localStorage.delay_sec}),window.close()})),"entire"==c&&(t(),o({action:c}),t()),"selected"==c&&(r?(window.close(),o({action:c})):o({action:"https"}),window.close()),"upload"==c){n=chrome.extension.getURL("")+"upload.html";chrome.tabs.create({url:n}),window.close()}if("record-video"==c&&e("record-menu"),"my-videos"==c&&chrome.tabs.create({url:"/video-list.html"}),"option"==c){n=chrome.extension.getURL("")+"options.html";chrome.tabs.create({url:n}),window.close()}if("help"==c){var n=chrome.extension.getURL("")+"help.html";chrome.tabs.create({url:n}),window.close()}"desktop"==c&&(Bg.beginDesktop(),window.close()),"collage"==c&&(chrome.tabs.create({url:chrome.extension.getURL("")+"collage.html"}),window.close()),"donate"==c&&(chrome.tabs.create({url:chrome.extension.getURL("")+"purchase.html"}),window.close()),"my-project"==c&&(chrome.tabs.create({url:"https://www.awesomescreenshot.com/getProjectList"}),window.close()),"my-account"==c&&(chrome.tabs.create({url:"https://www.awesomescreenshot.com/user/profile?tab=profile"}),window.close()),"log-out"==c&&(chrome.tabs.create({url:"https://www.awesomescreenshot.com/user/loginOut"}),window.close()),"aws-login"==c&&(chrome.tabs.create({url:"https://www.awesomescreenshot.com/user/login"}),window.close()),"aws-info-upgrade"==c&&(Bg.googleEvent("upgrade from main menu","upgrade"),chrome.tabs.create({url:"https://www.awesomescreenshot.com/premium/upgrade"}),window.close())}),navigator.webkitGetUserMedia({audio:!0},function(){n=!0,"true"==localStorage.record_mic&&$("#record-mic").prop("checked",!0)},function(){}),$("#countdown-input").val(localStorage.record_countdown),$("#countdown-input").on("change",function(){localStorage.record_countdown=$(this).val()}),Bg.getPremium().then(function(e){e&&$(".record-tip").hide()}),$("input[name=record-type]").on("change",function(){localStorage.record_type=this.value,$(".record-type-item").find("label").removeClass("selected"),$("#record-type-"+this.value).parent().addClass("selected")}),$("#record-type-"+localStorage.record_type).trigger("click").trigger("change"),$("#record-mic").on("change",function(){$(this).prop("checked")?!0===n?localStorage["record-mic"]="true":chrome.tabs.create({url:"/getMic.html"}):localStorage["record-mic"]="false"}),$("#back-to-main").on("click",function(){e("main-menu")}),$("#record-stop").on("click",function(){Bg.stopStream()}),$("#record-pause").on("click",function(){$(this).parent().addClass("paused"),Bg.pauseScreenRecording()}),$("#record-resume").on("click",function(){$(this).parent().removeClass("paused"),Bg.resumeScreenRecording()}),$("#record-start").on("click",function(){o({action:"record",options:{isRecordMic:$("#record-mic").prop("checked"),recordType:$("input[name=record-type]:checked").val(),countdown:$("#countdown-input").val()}}),window.close()}),$("#upgrade-btn").on("click",function(){Bg.googleEvent("upgrade from recording menu","upgrade"),Bg.goToUpgrade()});var n=!1});